{% extends "base.html" %}
{% block content %}

<div class="automation-container" style="margin-top: 1%;">
  <label class="switch">
    <input type="checkbox" id="automationToggle">
    <span class="slider round"></span>
  </label>
  <span id="automationStatus">Bet√∂lt√©s...</span>
</div>

<h3>√ñnt√∂z≈ë Programok</h2>

<table class="table-style" id="programs-table">
  <thead>
    <tr>
      <th>Program</th>
      <th>Akt√≠v</th>
      <th>Frekvencia</th>
      <th>Als√≥ hat√°r</th>
      <th>Fels≈ë hat√°r</th>
      <th>Fut√°sok</th>
      <th>
        <button id="add-program"><i class="bi bi-plus-circle"></i></button>
        <button id="refresh-programs"><i class="bi bi-arrow-clockwise"></i></button>
      </th>
    </tr>
  </thead>
  <tbody id="programs-body">
    <!-- Rows populated by JS -->
  </tbody>

  <!-- Form as a table row -->
  <tr id="add-form-row" style="display: none; background-color: #f9f9f9;">
    <td colspan="7">
      <h4 style="text-align: left;">√öj program</h4>
      <form id="add-program-form" style="display:flex; gap:4px; align-items:center;">
        <input type="text" name="name" placeholder="Program n√©v" required>
        <select name="is_active">
          <option value="true">‚úÖ</option>
          <option value="false">‚ùå</option>
        </select>
        <input type="number" name="frequency" placeholder="Frekvencia" required>
        <input type="number" step="0.01" name="lower_score" placeholder="Als√≥ hat√°r (0-5)" required>
        <input type="number" step="0.01" name="upper_score" placeholder="Fels≈ë hat√°r (0-5)" required>
        <div id="add-sessions-container" style="display:flex; flex-direction:column;"></div>
        <!-- <button type="button" class="add-session">‚úö</button> -->
        <button type="submit">‚úî</button>
      </form>
    </td>
  </tr>
  <tr>
    <td colspan="7">
      <div id="add-response-message" style="text-align: center; font-weight: bold;"></div>
    </td>
  </tr>
</table>

<div style="margin: 5%;"></div>
<h3>Ad hoc √∂nt√∂z√©s</h3>
<table class="table-style" id="ad-hoc-session">
  <thead>
    <tr>
      <th>Z√≥na 1</th>
      <th>Z√≥na 2</th>
      <th>Z√≥na 3</th>
      <th>Z√≥na 1 2</th>
      <th>Ki/Be</th>
      <th></th> 
    </tr>
  </thead>
  <tbody>
    <tr id="irrigation-control-row">
      <td><input type="number" id="zone1" min="0" max="60" placeholder="perc"></td>
      <td><input type="number" id="zone2" min="0" max="60" placeholder="perc"></td>
      <td><input type="number" id="zone3" min="0" max="60" placeholder="perc"></td>
      <td><input type="number" id="zone_connected" min="0" max="60" placeholder="perc"></td>
      <td>
        <label class="switch">
          <input type="checkbox" id="is_active">
          <span class="slider"></span>
        </label>
      </td>
      <td>
        <button id="send-irrigation">üíß Start</button>
      </td>
    </tr>
    <!-- Rows populated by JS -->
  </tbody>
</table>

<tbody id="ad-hoc-session-body">
    <!-- Rows populated by JS -->
</tbody>

<div class="score-card" style="margin-top: 5%;">
  <div class="score-header">
     <h3>P√°rolg√°s er≈ëss√©ge</h3>
    <span id="score-value" class="score-value">‚Äì</span>
  </div>

  <svg id="score-svg" class="score-svg" viewBox="0 0 640 80" role="img" aria-labelledby="scoreTitle scoreDesc">
    <title id="scoreTitle">√ñnt√∂z√©si pontsz√°m h≈ët√©rk√©pes s√°vval</title>
    <desc id="scoreDesc">V√≠zszintes s√°v 0-t√≥l 6-ig, sz√≠n√°tmenettel. Piros pont jelzi az aktu√°lis √©rt√©ket.</desc>

    <!-- Gradient (Viridis-like) -->
    <defs>
      <linearGradient id="scoreGradient" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%"   stop-color="#150184"/>
        <stop offset="25%"  stop-color="#018415"/>
        <stop offset="50%"  stop-color="#fd7b25"/>
        <stop offset="75%"  stop-color="#fd253b"/>
        <stop offset="100%" stop-color="#360006 "/>
      </linearGradient>
    </defs>

    <!-- Bar track and gradient fill -->
    <rect x="40" y="36" width="560" height="8" rx="4" fill="#e6e6e6"></rect>
    <rect x="40" y="36" width="560" height="8" rx="4" fill="url(#scoreGradient)"></rect>

    <!-- Ticks and labels -->
    <g fill="#666" font-size="12">
      <text x="40"  y="24">0</text>
      <text x="600" y="24" text-anchor="end">5</text>
    </g>

    <!-- Marker -->
    <circle id="score-marker" cx="40" cy="40" r="7" fill="#e53935" stroke="#fff" stroke-width="2"></circle>
  </svg>

  <div class="score-footer">
    <small id="score-updated" class="score-updated">Bet√∂lt√©s‚Ä¶</small>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script>
  console.log("Inline script test");
</script>
<script src="{{ url_for('static', path='/js/irrigation.js') }}"></script>
{% endblock %}
